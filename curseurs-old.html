<!DOCTYPE html>
<html lang="fr">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Configuration Enseignement à Distance</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <!-- Sortable Library -->
    <script src="https://cdnjs.cloudflare.com/ajax/libs/Sortable/1.15.0/Sortable.min.js"></script>
    <!-- Material Icons -->
    <link href="https://fonts.googleapis.com/icon?family=Material+Icons+Round" rel="stylesheet">
    <style>
        @import url('https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600;700&display=swap');
        
        body {
            font-family: 'Inter', sans-serif;
            background-color: #f1f5f9;
        }

        /* Slider Custom Styling to match theme */
        input[type=range] {
            -webkit-appearance: none; 
            background: transparent; 
        }
        
        input[type=range]::-webkit-slider-thumb {
            -webkit-appearance: none;
            height: 24px;
            width: 24px;
            border-radius: 50%;
            background: #4f46e5; /* Indigo-600 */
            cursor: grab;
            margin-top: -10px; 
            box-shadow: 0 4px 6px -1px rgba(79, 70, 229, 0.4);
            border: 2px solid white;
        }

        input[type=range]::-webkit-slider-runnable-track {
            width: 100%;
            height: 6px;
            cursor: pointer;
            background: #e2e8f0; /* Slate-200 */
            border-radius: 9999px;
        }

        input[type=range]:focus {
            outline: none;
        }

        /* Sortable ghost styles */
        .sortable-ghost {
            opacity: 0.4;
            background-color: #f1f5f9;
            border: 2px dashed #94a3b8;
        }
        
        .panel-content {
            transition: max-height 0.3s ease-out, opacity 0.3s ease-out;
            max-height: 0;
            opacity: 0;
            overflow: hidden;
        }
        .panel-content.open {
            max-height: 2000px;
            opacity: 1;
        }
        
        .rotate-icon { transition: transform 0.3s ease; }
        .rotate-icon.open { transform: rotate(180deg); }

        .risk-matrix th, .risk-matrix td { border: 1px solid #e2e8f0; }
        .risk-matrix .risk-none { background-color: #f8fafc; color: #94a3b8; }
        .risk-matrix .risk-low { background-color: #dcfce7; color: #166534; }    /* Green-100 / Green-800 */
        .risk-matrix .risk-medium { background-color: #fef9c3; color: #854d0e; } /* Yellow-100 / Yellow-800 */
        .risk-matrix .risk-high { background-color: #fee2e2; color: #991b1b; }   /* Red-100 / Red-800 */
        .risk-matrix .diagonal { background-color: #f1f5f9; color: #cbd5e1; }
    </style>
</head>
<body class="p-4 md:p-8">

    <div class="max-w-7xl mx-auto">
        <!-- Header -->
        <header class="flex flex-col xl:flex-row xl:items-end justify-between mb-8 gap-6">
            <div class="mb-2 xl:mb-0">
                <h1 class="text-3xl font-bold text-slate-900">Configuration Enseignement à Distance</h1>
                <p class="text-slate-500">Définissez et analysez vos choix pédagogiques</p>
            </div>
            
            <div class="flex flex-wrap gap-4 items-end">
                <!-- Toolbar -->
                <div class="flex flex-col gap-1">
                    <span class="text-[10px] font-bold text-slate-400 uppercase tracking-wider pl-1">Outils</span>
                    <div class="flex items-center bg-white border border-slate-200 rounded-lg p-1 gap-1 shadow-sm h-[46px]">
                        <button onclick="togglePanel('matrixPanel')" class="text-slate-600 hover:text-indigo-600 hover:bg-indigo-50 px-3 py-2 rounded-md transition-colors flex items-center gap-2" title="Voir la matrice des risques">
                            <span class="material-icons-round text-xl">grid_on</span>
                            <span class="text-sm font-medium hidden md:inline">Matrice</span>
                        </button>
                        <button onclick="togglePanel('orderPanel')" class="text-slate-600 hover:text-indigo-600 hover:bg-indigo-50 px-3 py-2 rounded-md transition-colors flex items-center gap-2" title="Réorganiser les curseurs">
                            <span class="material-icons-round text-xl">sort</span>
                            <span class="text-sm font-medium hidden md:inline">Ordre</span>
                        </button>
                         <button onclick="togglePanel('helpPanel')" class="text-slate-600 hover:text-indigo-600 hover:bg-indigo-50 px-3 py-2 rounded-md transition-colors flex items-center gap-2" title="Répertoire des alertes">
                            <span class="material-icons-round text-xl">list_alt</span>
                            <span class="text-sm font-medium hidden md:inline">Alertes</span>
                        </button>
                        <div class="w-px bg-slate-200 my-1 mx-1"></div>
                        <button onclick="resetAll()" class="text-slate-600 hover:text-indigo-600 hover:bg-indigo-50 px-3 py-2 rounded-md transition-colors flex items-center gap-2" title="Réinitialiser">
                            <span class="material-icons-round text-xl">restart_alt</span>
                            <span class="text-sm font-medium hidden md:inline">Réinitialiser</span>
                        </button>
                    </div>
                </div>
            </div>
        </header>

        <!-- Foldable: Reorder Panel -->
        <div id="orderPanel" class="mb-6 bg-white rounded-xl shadow-sm border border-slate-200 overflow-hidden panel-content">
            <div class="p-6">
                <div class="flex justify-between items-center mb-4">
                    <h3 class="text-lg font-bold text-slate-800 flex items-center gap-2">
                        <span class="material-icons-round text-slate-400">sort</span>
                        Réorganiser les dimensions
                    </h3>
                    <button onclick="togglePanel('orderPanel')" class="text-slate-400 hover:text-slate-600"><span class="material-icons-round">close</span></button>
                </div>
                <p class="text-sm text-slate-500 mb-4">Glissez-déposez les éléments ci-dessous pour changer l'ordre d'affichage des curseurs.</p>
                <ul id="sortableList" class="space-y-2 max-w-2xl">
                    <!-- List items generated by JS -->
                </ul>
                <div class="mt-4 pt-4 border-t border-slate-100">
                    <button onclick="applyOrder()" class="bg-indigo-600 hover:bg-indigo-700 text-white px-4 py-2 rounded-lg text-sm font-bold shadow-sm transition-colors">
                        Appliquer cet ordre
                    </button>
                </div>
            </div>
        </div>

        <!-- Foldable: Risk Matrix -->
        <div id="matrixPanel" class="mb-6 bg-white rounded-xl shadow-sm border border-slate-200 overflow-hidden panel-content">
             <div class="p-6">
                <div class="flex justify-between items-center mb-4">
                    <h3 class="text-lg font-bold text-slate-800 flex items-center gap-2">
                        <span class="material-icons-round text-slate-400">grid_on</span>
                        Matrice des risques de combinaison
                    </h3>
                    <button onclick="togglePanel('matrixPanel')" class="text-slate-400 hover:text-slate-600"><span class="material-icons-round">close</span></button>
                </div>
                <p class="text-sm text-slate-500 mb-6">Cette matrice montre le niveau de risque pédagogique lorsque deux dimensions sont positionnées vers leurs pôles extrêmes.</p>
                
                <div class="overflow-x-auto">
                    <table class="risk-matrix w-full text-xs text-center border-collapse rounded-lg overflow-hidden" id="riskMatrix">
                        <!-- Generated by JS -->
                    </table>
                </div>
                
                <div class="flex gap-6 mt-4 text-xs font-medium text-slate-600">
                    <div class="flex items-center gap-2"><span class="w-3 h-3 rounded-full bg-green-200 border border-green-300"></span> Faible risque</div>
                    <div class="flex items-center gap-2"><span class="w-3 h-3 rounded-full bg-yellow-100 border border-yellow-200"></span> Risque modéré</div>
                    <div class="flex items-center gap-2"><span class="w-3 h-3 rounded-full bg-red-100 border border-red-200"></span> Risque élevé</div>
                </div>
            </div>
        </div>

        <!-- Foldable: Alerts Directory -->
        <div id="helpPanel" class="mb-6 bg-blue-50 rounded-xl shadow-sm border border-blue-100 overflow-hidden panel-content">
            <div class="p-6">
                 <div class="flex justify-between items-center mb-4">
                    <h3 class="text-lg font-bold text-indigo-900 flex items-center gap-2">
                        <span class="material-icons-round text-indigo-400">list_alt</span>
                        Répertoire des alertes
                    </h3>
                    <button onclick="togglePanel('helpPanel')" class="text-slate-400 hover:text-slate-600"><span class="material-icons-round">close</span></button>
                </div>
                <div id="alertsListContent" class="grid grid-cols-1 md:grid-cols-2 gap-3 text-sm text-slate-700">
                    <!-- Static list of potential alerts for reference -->
                    <div class="bg-white p-3 rounded border border-blue-100"><strong>Synchrone + Sans accompagnement :</strong> sessions difficiles à gérer sans régulation.</div>
                    <div class="bg-white p-3 rounded border border-blue-100"><strong>Collaboratif + Asynchrone :</strong> nécessite structure forte et outils adaptés.</div>
                    <div class="bg-white p-3 rounded border border-blue-100"><strong>Production + Sans accompagnement :</strong> risque de manque de guidage et feedback.</div>
                    <div class="bg-white p-3 rounded border border-blue-100"><strong>Synchrone + Production + Collaboratif :</strong> coordination très lourde en temps réel.</div>
                    <div class="bg-white p-3 rounded border border-blue-100"><strong>Grand groupe + Accompagnement fort :</strong> difficilement tenable à l'échelle.</div>
                    <div class="bg-white p-3 rounded border border-blue-100"><strong>Distance + Synchrone :</strong> dépendance technique et attention limitée.</div>
                    <div class="bg-white p-3 rounded border border-blue-100"><strong>Distance + Grand groupe + Sans accompagnement :</strong> risque élevé d'isolement/abandon.</div>
                </div>
            </div>
        </div>

        <div class="grid grid-cols-1 lg:grid-cols-3 gap-8 items-start">
            
            <!-- Main Column: Sliders -->
            <div class="lg:col-span-2 space-y-6" id="slidersContainer">
                <!-- Sliders injected here -->
            </div>

            <!-- Right Column: Live Alerts & Info -->
            <div class="space-y-6 sticky top-6">
                
                <!-- Live Alerts Panel -->
                <div class="bg-white p-5 rounded-2xl shadow-sm border border-slate-200">
                    <h3 class="font-bold text-slate-800 mb-4 flex items-center gap-2">
                        <span class="material-icons-round text-amber-500">warning_amber</span>
                        Analyse en direct
                    </h3>
                    <div id="alertsContainer" class="space-y-3">
                        <!-- Alerts injected here -->
                        <div class="text-sm text-slate-400 italic text-center py-4">Aucune alerte pour cette configuration.</div>
                    </div>
                </div>

                <!-- Footer / Credits -->
                <div class="bg-slate-50 p-5 rounded-2xl border border-slate-200 text-xs text-slate-500 leading-relaxed">
                    <p class="font-bold text-slate-700 mb-2">À propos</p>
                    <p class="mb-2">Cet outil permet de configurer votre dispositif selon 6 dimensions. Il détecte automatiquement les incohérences.</p>
                    <p class="mb-2">Inspiré de : <em>Enseigner à distance: 5 balises pour vous lancer</em> (Docq et al., 2023, Presses universitaires de Louvain).</p>
                    <p class="mt-2 italic border-t border-slate-200 pt-2">
                        <span class="material-icons-round text-xs align-middle mr-1">security</span>
                        Traitement local : toutes les données restent sur votre navigateur, rien n'est envoyé en ligne.
                    </p>
                    <p class="mt-2 text-[10px] uppercase font-bold text-slate-400">CC BY-SA • François Jourde & Jacques Dubois (2026)</p>
                </div>

            </div>
        </div>
    </div>

    <!-- Templates embedded in JS for simplicity -->

    <script>
        // --- Data & State ---
        var dimensions = [
            { id: 0, leftTitle: "PRÉSENCE", rightTitle: "DISTANCE", leftDesc: "Institutionnalisation d'un temps/lieu de formation.", rightDesc: "Souplesse temporelle, géographique et pédagogique.", value: 50 },
            { id: 1, leftTitle: "PETIT GROUPE", rightTitle: "GRAND GROUPE", leftDesc: "Effectif réduit permettant un suivi proche.", rightDesc: "Effectif important impactant l'accompagnement.", value: 50 },
            { id: 2, leftTitle: "ASYNCHRONE", rightTitle: "SYNCHRONE", leftDesc: "Activités réalisées en temps différé (flexibilité).", rightDesc: "Interactions en temps réel (rendez-vous virtuels).", value: 50 },
            { id: 3, leftTitle: "INDIVIDUEL", rightTitle: "COLLABORATIF", leftDesc: "Activités et travaux personnels.", rightDesc: "Activités de groupe et coopération.", value: 50 },
            { id: 4, leftTitle: "APPROPRIATION", rightTitle: "PRODUCTION", leftDesc: "Consommation et compréhension de ressources.", rightDesc: "Création de nouvelles ressources par l'étudiant.", value: 50 },
            { id: 5, leftTitle: "AVEC ACCOMPAGNEMENT", rightTitle: "SANS ACCOMPAGNEMENT", leftDesc: "Interaction forte enseignant/étudiant.", rightDesc: "Autonomie complète de l'étudiant.", value: 50 }
        ];

        var riskDefinitions = [
            [0, 2, "high_high", 2], [0, 3, "high_high", 2], [0, 5, "high_high", 3], [0, 2, "low_low", 2],
            [1, 3, "high_high", 2], [1, 4, "high_high", 2], [1, 5, "high_low", 2], [2, 3, "low_high", 2],
            [2, 5, "high_high", 3], [3, 5, "high_high", 2], [4, 5, "high_high", 3]
        ];

        var dimNames = ["Distance", "Grd groupe", "Synchrone", "Collaboratif", "Production", "Sans acc."];
        var currentOrder = [0, 1, 2, 3, 4, 5];

        // --- Core Functions ---

        function getVal(id) { 
            return dimensions.find(d => d.id === id).value; 
        }

        function togglePanel(panelId) {
            const panel = document.getElementById(panelId);
            if (panel.classList.contains('open')) {
                panel.classList.remove('open');
            } else {
                // Close others if needed, or keep multiple open. Let's keep multiple.
                panel.classList.add('open');
                if(panelId === 'matrixPanel') renderMatrix();
                if(panelId === 'orderPanel') renderSortableList();
            }
        }

        function renderSliders() {
            var container = document.getElementById("slidersContainer");
            var html = "";
            
            currentOrder.forEach(idx => {
                var dim = dimensions[idx];
                html += `
                <div id="slider-card-${dim.id}" class="slider-card bg-white p-6 rounded-2xl shadow-sm border border-slate-200 transition-all hover:shadow-md">
                    <div class="flex justify-between items-end mb-4">
                        <div class="w-5/12 text-left">
                            <h3 class="text-sm font-bold text-slate-800 mb-1">${dim.leftTitle}</h3>
                            <p class="text-xs text-slate-500 leading-snug">${dim.leftDesc}</p>
                        </div>
                        
                        <div class="w-2/12 flex justify-center pb-2">
                             <button onclick="updateVal(${dim.id}, 50); updateInput(${dim.id}, 50)" class="text-slate-300 hover:text-indigo-500 transition-colors p-1" title="Recentrer">
                                <span class="material-icons-round text-lg">restart_alt</span>
                            </button>
                        </div>

                        <div class="w-5/12 text-right">
                            <h3 class="text-sm font-bold text-slate-800 mb-1">${dim.rightTitle}</h3>
                            <p class="text-xs text-slate-500 leading-snug">${dim.rightDesc}</p>
                        </div>
                    </div>
                    
                    <div class="relative h-10 flex items-center">
                        <!-- Track Background Visuals -->
                        <div class="absolute w-full h-2 bg-slate-100 rounded-full overflow-hidden">
                            <div class="w-1/2 h-full bg-slate-200/50"></div>
                        </div>
                        <!-- Input -->
                        <input type="range" min="0" max="100" value="${dim.value}" id="range-${dim.id}"
                            class="w-full relative z-10 appearance-none bg-transparent" 
                            oninput="updateVal(${dim.id}, this.value)">
                    </div>
                </div>
                `;
            });
            container.innerHTML = html;
        }

        function updateVal(id, val) {
            var dim = dimensions.find(d => d.id === id);
            dim.value = parseInt(val);
            checkAlerts();
            if(document.getElementById('matrixPanel').classList.contains('open')) renderMatrix();
        }

        // Helper to update visual input position when using the reset button
        function updateInput(id, val) {
            const input = document.getElementById(`range-${id}`);
            if(input) input.value = val;
        }

        function checkAlerts() {
            var p = getVal(0), n = getVal(1), t = getVal(2), c = getVal(3), r = getVal(4), a = getVal(5);
            var alerts = [];
            var conflictSet = new Set();
            
            function add(condition, msg, dims) {
                if(condition) {
                    alerts.push(msg);
                    dims.forEach(d => conflictSet.add(d));
                }
            }
            
            // Alert Logic
            add(t > 65 && a > 65, "<strong>Synchrone + Sans accompagnement :</strong> Les sessions live nécessitent une régulation active.", [2, 5]);
            add(c > 65 && t < 35, "<strong>Collaboratif + Asynchrone :</strong> Nécessite une structuration très forte pour coordonner le groupe.", [3, 2]);
            add(r > 65 && a > 65, "<strong>Production + Sans accompagnement :</strong> Risque de blocage sans feedback sur les productions.", [4, 5]);
            add(t > 65 && c > 65 && r > 65 && a > 65, "<strong>Configuration extrême :</strong> Exige une très grande autonomie des étudiants.", [2, 3, 4, 5]);
            add(t > 65 && r > 65 && c > 65 && a <= 65, "<strong>Synchrone + Prod + Collab :</strong> Coordination en temps réel très complexe à animer.", [2, 4, 3]);
            add(n > 65 && a < 35, "<strong>Grand groupe + Accompagnement fort :</strong> Difficilement tenable sans une grande équipe pédagogique.", [1, 5]);
            add(p > 65 && t > 65, "<strong>Distance + Synchrone :</strong> Attention à la qualité technique et la fatigue Zoom.", [0, 2]);
            add(p > 65 && n > 65 && a > 65, "<strong>Distance + Grand gpe + Sans acc :</strong> Risque maximal d'isolement et d'abandon (MOOC style).", [0, 1, 5]);
            add(p > 65 && c > 65, "<strong>Distance + Collaboratif :</strong> Nécessite des outils collaboratifs performants.", [0, 3]);
            add(n > 65 && c > 65, "<strong>Grand groupe + Collaboratif :</strong> Logistique lourde (sous-groupes, suivi).", [1, 3]);
            add(n > 65 && r > 65, "<strong>Grand groupe + Production :</strong> La correction/feedback de productions nombreuses est chronophage.", [1, 4]);
            add(p < 35 && t < 35, "<strong>Présence + Asynchrone :</strong> Peu cohérent. Profitez de la présence pour l'interaction synchrone.", [0, 2]);

            // Render Alerts
            var container = document.getElementById("alertsContainer");
            if (alerts.length === 0) {
                container.innerHTML = '<div class="text-sm text-slate-400 italic text-center py-4 bg-slate-50 rounded-lg border border-dashed border-slate-200">Aucune alerte détectée pour cette configuration.</div>';
            } else {
                container.innerHTML = alerts.map(txt => `
                    <div class="flex items-start gap-3 bg-amber-50 border-l-4 border-amber-400 p-3 rounded-r-lg text-sm text-amber-900 shadow-sm">
                        <span class="material-icons-round text-amber-500 text-lg mt-0.5">warning</span>
                        <div class="leading-relaxed">${txt}</div>
                    </div>
                `).join("");
            }

            // Update Visual Cues
            dimensions.forEach(dim => {
                const card = document.getElementById(`slider-card-${dim.id}`);
                if (card) {
                    if (conflictSet.has(dim.id)) {
                        card.classList.remove('border-slate-200', 'bg-white');
                        card.classList.add('border-amber-400', 'bg-amber-50');
                    } else {
                        card.classList.add('border-slate-200', 'bg-white');
                        card.classList.remove('border-amber-400', 'bg-amber-50');
                    }
                }
            });
        }

        function getRiskLevel(d1, d2) {
            var v1 = getVal(d1), v2 = getVal(d2);
            for (var i = 0; i < riskDefinitions.length; i++) {
                var rd = riskDefinitions[i];
                if ((rd[0] === d1 && rd[1] === d2) || (rd[0] === d2 && rd[1] === d1)) {
                    var c = rd[2], l = rd[3], m = false;
                    if (c === "high_high" && v1 > 65 && v2 > 65) m = true;
                    if (c === "low_low" && v1 < 35 && v2 < 35) m = true;
                    if (c === "high_low" && v1 > 65 && v2 < 35) m = true;
                    if (c === "low_high" && v1 < 35 && v2 > 65) m = true;
                    if (m) return l;
                }
            }
            return 0;
        }

        function renderMatrix() {
            var html = "<thead><tr><th class='bg-slate-50 p-2 border-slate-200'></th>";
            for (var i = 0; i < 6; i++) html += "<th class='bg-slate-50 p-2 font-bold text-slate-600 border-slate-200'>" + dimNames[i] + "</th>";
            html += "</tr></thead><tbody>";
            
            for (var row = 0; row < 6; row++) {
                html += "<tr><th class='bg-slate-50 p-2 text-left font-bold text-slate-600 border-slate-200 min-w-[80px]'>" + dimNames[row] + "</th>";
                for (var col = 0; col < 6; col++) {
                    if (row === col) { 
                        html += "<td class='diagonal p-2'></td>"; 
                    } else {
                        var risk = getRiskLevel(row, col);
                        var cls = "risk-none", txt = "—";
                        if (risk === 1) { cls = "risk-low"; txt = "Faible"; }
                        if (risk === 2) { cls = "risk-medium"; txt = "Modéré"; }
                        if (risk === 3) { cls = "risk-high"; txt = "Élevé"; }
                        html += "<td class='" + cls + " p-2 font-medium'>" + txt + "</td>";
                    }
                }
                html += "</tr>";
            }
            html += "</tbody>";
            document.getElementById("riskMatrix").innerHTML = html;
        }

        // --- Sortable Logic ---
        function renderSortableList() {
            var list = document.getElementById("sortableList");
            list.innerHTML = "";
            currentOrder.forEach(idx => {
                var dim = dimensions[idx];
                var li = document.createElement("li");
                li.className = "flex items-center gap-3 bg-slate-50 p-3 rounded-lg border border-slate-200 cursor-grab active:cursor-grabbing sortable-item";
                li.setAttribute("data-id", dim.id);
                li.innerHTML = `
                    <span class="material-icons-round text-slate-300">drag_indicator</span>
                    <span class="font-medium text-slate-700 text-sm">${dim.leftTitle} <span class="text-slate-400 mx-2">↔</span> ${dim.rightTitle}</span>
                `;
                list.appendChild(li);
            });

            new Sortable(list, {
                animation: 150,
                ghostClass: 'sortable-ghost'
            });
        }

        function applyOrder() {
            var listItems = document.querySelectorAll("#sortableList li");
            var newOrder = [];
            listItems.forEach(item => {
                newOrder.push(parseInt(item.getAttribute("data-id")));
            });
            currentOrder = newOrder;
            renderSliders();
            togglePanel('orderPanel'); // Close panel
        }

        function resetAll() {
            if(confirm('Réinitialiser tous les curseurs à 50% ?')) {
                dimensions.forEach(d => {
                    d.value = 50;
                    updateInput(d.id, 50);
                });
                renderSliders();
                checkAlerts();
                if(document.getElementById('matrixPanel').classList.contains('open')) renderMatrix();
            }
        }

        // --- Init ---
        renderSliders();
        checkAlerts();
    </script>
</body>
</html>
